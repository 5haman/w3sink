(function(q){if(q.DataView){return}var j=function(w){throw new Error(w)};if(!q.ArrayBuffer){j("ArrayBuffer not supported")}if(!Object.defineProperties){j("This module requires ECMAScript 5")}var i=new Int8Array(new Int32Array([1]).buffer)[0]===1;var s=new Uint8Array(8);var t=function(w,A,z,B,y){var x=0;if(B===undefined){j("Missing required offset argument")}if(B<0||B+z>w.byteLength){j("Invalid index: "+B)}if(z===1||y===i){if((w.byteOffset+B)%z===0){return(new A(w.buffer,w.byteOffset+B,1))[0]}for(x=0;x<z;x++){s[x]=w._bytes[B+x]}return(new A(s.buffer))[0]}else{for(x=0;x<z;x++){s[z-x-1]=w._bytes[B+x]}return(new A(s.buffer))[0]}};var o=function(w,A,z,C,B,y){var x=0;if(C===undefined){j("Missing required offset argument")}if(B===undefined){j("Missing required value argument")}if(C<0||C+z>w.byteLength){j("Invalid index: "+C)}if(z===1||y===i){if((w.byteOffset+C)%z===0){(new A(w.buffer,w.byteOffset+C,1))[0]=B}else{(new A(s.buffer))[0]=B;for(x=0;x<z;x++){w._bytes[x+C]=s[x]}}}else{(new A(s.buffer))[0]=B;for(x=0;x<z;x++){w._bytes[C+x]=s[z-1-x]}}};q.DataView=function c(w,y,x){if(!(w instanceof ArrayBuffer)){j("Bad ArrayBuffer")}y=y||0;x=x||(w.byteLength-y);if(y<0||x<0||y+x>w.byteLength){j("Illegal offset and/or length")}Object.defineProperties(this,{buffer:{value:w,enumerable:false,writable:false,configurable:false},byteOffset:{value:y,enumerable:false,writable:false,configurable:false},byteLength:{value:x,enumerable:false,writable:false,configurable:false},_bytes:{value:new Uint8Array(w,y,x),enumerable:false,writable:false,configurable:false}})};q.DataView.prototype={constructor:c,getInt8:function k(w){return t(this,Int8Array,1,w)},getUint8:function n(w){return t(this,Uint8Array,1,w)},getInt16:function l(x,w){return t(this,Int16Array,2,x,w)},getUint16:function g(x,w){return t(this,Uint16Array,2,x,w)},getInt32:function d(x,w){return t(this,Int32Array,4,x,w)},getUint32:function v(x,w){return t(this,Uint32Array,4,x,w)},getFloat32:function r(x,w){return t(this,Float32Array,4,x,w)},getFloat64:function r(x,w){return t(this,Float64Array,8,x,w)},setInt8:function a(x,w){o(this,Int8Array,1,x,w)},setUint8:function m(x,w){o(this,Uint8Array,1,x,w)},setInt16:function h(y,x,w){o(this,Int16Array,2,y,x,w)},setUint16:function u(y,x,w){o(this,Uint16Array,2,y,x,w)},setInt32:function b(y,x,w){o(this,Int32Array,4,y,x,w)},setUint32:function p(y,x,w){o(this,Uint32Array,4,y,x,w)},setFloat32:function f(y,x,w){o(this,Float32Array,4,y,x,w)},setFloat64:function e(y,x,w){o(this,Float64Array,8,y,x,w)}}}(this));(function(a){if(!a.netstream){a.netstream={}}a.netstream.constants={EVENT_GETVERSION:0,EVENT_START:1,EVENT_END:2,EVENT_ADD_NODE:16,EVENT_DEL_NODE:17,EVENT_ADD_EDGE:18,EVENT_DEL_EDGE:19,EVENT_STEP:20,EVENT_CLEARED:21,EVENT_ADD_GRAPH_ATTR:22,EVENT_CHG_GRAPH_ATTR:23,EVENT_DEL_GRAPH_ATTR:24,EVENT_ADD_NODE_ATTR:25,EVENT_CHG_NODE_ATTR:26,EVENT_DEL_NODE_ATTR:27,EVENT_ADD_EDGE_ATTR:28,EVENT_CHG_EDGE_ATTR:29,EVENT_DEL_EDGE_ATTR:30,TYPE_BOOLEAN:80,TYPE_BOOLEAN_ARRAY:81,TYPE_BYTE:82,TYPE_BYTE_ARRAY:83,TYPE_SHORT:84,TYPE_SHORT_ARRAY:85,TYPE_INT:86,TYPE_INT_ARRAY:87,TYPE_LONG:88,TYPE_LONG_ARRAY:89,TYPE_FLOAT:90,TYPE_FLOAT_ARRAY:91,TYPE_DOUBLE:92,TYPE_DOUBLE_ARRAY:93,TYPE_STRING:94,TYPE_RAW:95,TYPE_ARRAY:96}}(this));(function(a){if(!a.netstream){a.netstream={}}a.netstream.utf16to8=function(f){var d,e,b,g;d="";b=f.length;for(e=0;e<b;e++){g=f.charCodeAt(e);if((g>=1)&&(g<=127)){d+=f.charAt(e)}else{if(g>2047){d+=String.fromCharCode(224|((g>>12)&15));d+=String.fromCharCode(128|((g>>6)&63));d+=String.fromCharCode(128|((g>>0)&63))}else{d+=String.fromCharCode(192|((g>>6)&31));d+=String.fromCharCode(128|((g>>0)&63))}}}return d};a.netstream.TypedArrayReader=function(b){this.position=0;this.array=new Uint8Array(b.buffer,b.byteOffset,b.byteLength);this.readByte=function(){if(this.position>=this.array.length){return null}return this.array[this.position++]}};a.netstream.Utf8Translator=function(b){this.reader=b;this.waitBom=true;this.pendingChar=null;this.readChar=function(){var c=null;do{if(this.pendingChar!==null){c=this.pendingChar;this.pendingChar=null}else{var k=this.reader.readByte();if(k<0){return null}if((k&128)===0){c=String.fromCharCode(k)}else{var d=192;var m=5;do{var n=d>>1|128;if((k&n)===d){break}d=d>>1|128;--m}while(m>=0);if(m>0){var e=(k&((1<<m)-1));for(var h=5;h>=m;--h){var f=this.reader.readByte();if((f&192)!=128){throw"Invalid sequence character"}e=(e<<6)|(f&63)}if(e<=65535){if(e===65279&&this.waitBom){c=null}else{c=String.fromCharCode(e)}}else{var l=e-65536;var j=55296|((l>>10)&1023);var g=56320|(l&1023);this.pendingChar=String.fromCharCode(g);c=String.fromCharCode(j)}}else{throw"Invalid character"}}}this.waitBom=false}while(c===null);return c}};a.netstream.typedArrayToString=function(d){var c=new netstream.TypedArrayReader(d),e=new netstream.Utf8Translator(c),b=[],f=0,h=0,g="";h=e.readChar();while(h.charCodeAt(0)!==0){b[f++]=h;h=e.readChar()}g=b.join("");return g};a.netstream.base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_keyCode:{65:0,66:1,67:2,68:3,69:4,70:5,71:6,72:7,73:8,74:9,75:10,76:11,77:12,78:13,79:14,80:15,81:16,82:17,83:18,84:19,85:20,86:21,87:22,88:23,89:24,90:25,97:26,98:27,99:28,100:29,101:30,102:31,103:32,104:33,105:34,106:35,107:36,108:37,109:38,110:39,111:40,112:41,113:42,114:43,115:44,116:45,117:46,118:47,119:48,120:49,121:50,122:51,48:52,49:53,50:54,51:55,52:56,53:57,54:58,55:59,56:60,57:61,43:62,47:63,61:64},decode:function(l){var f=this._keyStr.indexOf(l[l.length-1]);var c=this._keyStr.indexOf(l[l.length-2]);var t=Math.ceil((3*l.length)/4);if(f==64){t--}if(c==64){t--}var h=new ArrayBuffer(t);var g;var s,q,o;var r,p,n,m;var e=0;var b=0;if(h){g=new Uint8Array(h)}else{g=new Uint8Array(t)}for(e=0;e<l.length;e++){var k=l[e];if((k<65||k>90)&&(k<97||k>122)&(k<47||k>57)&k!=61&k!=43){throw"illegal character in base64 string "+k}}for(e=0;e<t;e+=3){r=this._keyCode[l[b++]];p=this._keyCode[l[b++]];n=this._keyCode[l[b++]];m=this._keyCode[l[b++]];s=(r<<2)|(p>>4);q=((p&15)<<4)|(n>>2);o=((n&3)<<6)|m;g[e]=s;if(n!=64){g[e+1]=q}if(m!=64){g[e+2]=o}}return g},encode:function(h){var g="";if("slice" in h){var q=new Uint8Array(h)}else{var q=h}var o=q.byteLength;var f=o%3;var p=o-f;var n,l,k,j;var m;for(var e=0;e<p;e=e+3){m=(q[e]<<16)|(q[e+1]<<8)|q[e+2];n=(m&16515072)>>18;l=(m&258048)>>12;k=(m&4032)>>6;j=m&63;g+=this._keyStr[n]+this._keyStr[l]+this._keyStr[k]+this._keyStr[j]}if(f==1){m=q[p];n=(m&252)>>2;l=(m&3)<<4;g+=this._keyStr[n]+this._keyStr[l]+"=="}else{if(f==2){m=(q[p]<<8)|q[p+1];n=(m&64512)>>10;l=(m&1008)>>4;k=(m&15)<<2;g+=this._keyStr[n]+this._keyStr[l]+this._keyStr[k]+"="}}return g}};a.netstream.LOGGER=function(b){if(typeof(console.log)=="function"){console.log(b)}else{if(typeof(a.status)=="string"){a.status=b}}}}(this));(function(a){if(!a.netstream){a.netstream={}}a.netstream.Transport=function(b){this.BUFFER_INITIAL_SIZE=1048576;this.scheme="ws";this.host="localhost";this.port=2003;this.uri="/gs/stream";this.socket=null;this.verbose=true;this.base64=true;this.onevent=null;this.onopen=null;for(var c in b){if(b.hasOwnProperty(c)&&this.hasOwnProperty(c)){this[c]=b[c]}}this._queue=[];if(this.base64){this._sizeOfInt=8}else{this._sizeOfInt=4}this._tmp_view=new DataView(new ArrayBuffer(4));this._inputBuffer=new ArrayBuffer(this.BUFFER_INITIAL_SIZE);this._inputEnd=-1;this._inputBeg=0;this._inputPos=0};a.netstream.Transport.prototype={_initHeartbeating:function(){var b=this;this.refreshIntervalId=setInterval(function(c){if(b.socket.readyState===b.socket.CLOSED){clearInterval(b.refreshIntervalId)}else{if(b.debug){netstream.LOGGER("> Sending Hearbeat")}b.socket.send("Heartbeat")}},1000)},connect:function(){if(this.socket){return}var b=this;if(typeof(WebSocket)==="undefined"){this.socket=new MozWebSocket(this.scheme+"://"+this.host+":"+this.port+this.uri)}else{this.socket=new WebSocket(this.scheme+"://"+this.host+":"+this.port+this.uri)}this.refreshIntervalId=0;this.socket.onopen=function(){if(b.debug){netstream.LOGGER("(netstream.Transport): conection opened")}b._initHeartbeating();for(var c=0;c<b._queue.length;c++){b.socket.send(b._queue[c])}delete b._queue;if(typeof b.onopen==="function"){b.onopen()}};this.socket.onerror=function(c){netstream.LOGGER("(netstream.Transport): ERROR on the WebSocket")};this.socket.onmessage=function(c){if(b.debug===true){netstream.LOGGER("(netstream.Transport): < Received a "+c.data.length+" bytes long data chunk.")}b._handleMsg(c.data)}},sendEvent:function(b,d,c){if(this.base64){b=netstream.base64.encode(new Uint8Array(b,d,c));this._tmp_view.setUint32(0,b.length);b=netstream.base64.encode(this._tmp_view.buffer)+b;d=-1}else{}if(this.socket===null||this.socket.readyState<this.socket.OPEN){this.connect();this._queue.push(this.base64?b:b.slice(d,d+c))}else{if(this.socket.readyState===this.socket.OPEN){this.socket.send(this.base64?b:b.slice(d,d+c))}else{netstream.LOGGER("not sending....")}}},_do_send:function(b,d,c){},_compactInputBuffer:function(b){if(this._inputBeg>this._sizeOfInt){var d=this._inputBeg;var e=new Uint8Array(this._inputBuffer);for(var c=0;c<b-this._inputBeg;c++){e[c]=e[this._inputBeg+c]}this._inputPos-=this._inputBeg;this._inputEnd-=this._inputBeg;this._inputBeg=0;return d}return 0},_ensureInputBufferCapacity:function(d){if((d+this._inputPos)>this._inputBuffer.byteLength){if(this.debug){netstream.LOGGER("Actual buffer size is "+this._inputBuffer.byteLength+" resizing to "+1.4*(d+this._inputPos)+" bytes",d,this._inputPos)}var e=new ArrayBuffer(1.4*(d+this._inputPos));for(var c=0,b=this._inputBuffer.byteLength;c<b;c++){e[c]=this._inputBuffer[c]}delete this._inputBuffer;this._inputBuffer=e}},_unpackInputMessageSize:function(e){var b=new Uint8Array(this._inputBuffer,e,8);var c=new DataView(netstream.base64.decode(b).buffer);var d=c.getInt32(0);return d},_handleMsg:function(c){var b=0;var d=0;d=c.length;this._ensureInputBufferCapacity(d);var f=new Uint8Array(this._inputBuffer,this._inputPos,d);for(var e=0;e<d;e++){f[e]=c.charCodeAt(e)}b=this._inputPos+d;if(d<=0){return}if(this._inputEnd<0){if((b-this._inputBeg)>=this._sizeOfInt){this._inputEnd=this._unpackInputMessageSize(0)+this._sizeOfInt;this._inputBeg=this._sizeOfInt}else{this._inputPos=b}}if(this._inputEnd>0){while(this._inputEnd<b){this._receiveEvent();if(this._inputEnd+this._sizeOfInt<=b){this._inputBeg=this._inputEnd+this._sizeOfInt;this._inputEnd=this._inputEnd+this._unpackInputMessageSize(this._inputEnd)+this._sizeOfInt}else{this._inputBeg=this._inputEnd;var g=b-this._inputEnd;this._compactInputBuffer(b);this._inputPos=g;this._inputBeg=0;this._inputEnd=-1;break}}if(this._inputEnd==b){this._receiveEvent();this._inputPos=0;this._inputBeg=0;this._inputEnd=-1}else{if(this._inputEnd>b){this._inputPos=b;if(this._inputEnd>this._inputBuffer.byteLength){this._compactInputBuffer(b)}}}}},_receiveEvent:function(){if(this.base64){var b=new Uint8Array(this._inputBuffer,this._inputBeg,this._inputEnd-this._inputBeg);var c=new DataView(netstream.base64.decode(b).buffer)}else{var c=new DataView(this.InputBuffer,this._inputBeg,this._inputEnd-this._inputBeg)}this.onevent(c)}}}(this));(function(a){if(!a.netstream){a.netstream={}}a.netstream.DefaultSink=function(){};a.netstream.DefaultSink.prototype={nodeAdded:function(){},nodeRemoved:function(){},nodeAttributeAdded:function(){},nodeAttributeChanged:function(){},nodeAttributeRemoved:function(){},edgeAdded:function(){},edgeRemoved:function(){},edgeAttributeAdded:function(){},edgeAttributeChanged:function(){},edgeAttributeRemoved:function(){},graphAttributeAdded:function(){},graphAttributeChanged:function(){},graphAttributeRemoved:function(){},graphCleared:function(){},stepBegins:function(){}};a.netstream.DOMSink=function(b){this.element=b};a.netstream.DOMSink.prototype={element:"",appendMsg:function(d){var c=a.document.createTextNode(d);var b=a.document.createElement("p");b.appendChild(c);this.element.appendChild(b)},nodeAdded:function(c,b,d){this.appendMsg("(GSSink, "+c+":"+b+') : an "'+d+'"')},nodeRemoved:function(c,b,d){this.appendMsg("(GSSink, "+c+":"+b+') : dn "'+d+'"')},nodeAttributeAdded:function(e,b,f,d,c){this.appendMsg("(GSSink, "+e+":"+b+') : cn "'+f+'" "'+d+'":'+c)},nodeAttributeChanged:function(e,c,g,d,b,f){this.appendMsg("(GSSink, "+e+":"+c+') : cn "'+g+'" "'+d+'":'+f)},nodeAttributeRemoved:function(d,b,e,c){this.appendMsg("(GSSink, "+d+":"+b+') : cn "'+e+'" "'+c+'":null')},edgeAdded:function(d,c,e,g,f,b){this.appendMsg("(GSSink, "+d+":"+c+') : ae "'+e+'" "'+g+(b===true?'">"':'" "')+f+'"')},edgeRemoved:function(c,b,d){this.appendMsg("(GSSink, "+c+":"+b+') : de "'+d+'"')},edgeAttributeAdded:function(e,b,f,d,c){this.appendMsg("(GSSink, "+e+":"+b+') : ce "'+f+'" "'+d+'":'+c)},edgeAttributeChanged:function(e,c,g,d,b,f){this.appendMsg("(GSSink, "+e+":"+c+') : ce "'+g+'" "'+d+'":'+f)},edgeAttributeRemoved:function(d,b,e,c){this.appendMsg("(GSSink, "+d+":"+b+') : cn "'+e+'" "'+c+'":null')},graphAttributeAdded:function(e,b,d,c){this.appendMsg("(GSSink, "+e+":"+b+') : cg  "'+d+'":'+c)},graphAttributeChanged:function(e,c,d,b,f){this.appendMsg("(GSSink, "+e+":"+c+') : cg "'+d+'":'+f)},graphAttributeRemoved:function(d,b,e,c){this.appendMsg("(GSSink, "+d+":"+b+') : cg  "'+c+'":null')},graphCleared:function(c,b){this.appendMsg("(GSSink, "+c+":"+b+") : cl")},stepBegins:function(c,b,d){this.appendMsg("(GSSink, "+c+":"+b+") : st "+d)}};a.netstream.LoggerSink=function(){};a.netstream.LoggerSink.prototype={nodeAdded:function(c,b,d){netstream.LOGGER("(GSSink, "+c+":"+b+') : an "'+d+'"')},nodeRemoved:function(c,b,d){netstream.LOGGER("(GSSink, "+c+":"+b+') : dn "'+d+'"')},nodeAttributeAdded:function(e,b,f,d,c){netstream.LOGGER("(GSSink, "+e+":"+b+') : cn "'+f+'" "'+d+'":'+c)},nodeAttributeChanged:function(e,c,g,d,b,f){netstream.LOGGER("(GSSink, "+e+":"+c+') : cn "'+g+'" "'+d+'":'+f)},nodeAttributeRemoved:function(d,b,e,c){netstream.LOGGER("(GSSink, "+d+":"+b+') : cn "'+e+'" "'+c+'":null')},edgeAdded:function(d,c,e,g,f,b){netstream.LOGGER("(GSSink, "+d+":"+c+') : ae "'+e+'" "'+g+(b===true?'">"':'" "')+f+'"')},edgeRemoved:function(c,b,d){netstream.LOGGER("(GSSink, "+c+":"+b+') : de "'+d+'"')},edgeAttributeAdded:function(e,b,f,d,c){netstream.LOGGER("(GSSink, "+e+":"+b+') : ce "'+f+'" "'+d+'":'+c)},edgeAttributeChanged:function(e,c,g,d,b,f){netstream.LOGGER("(GSSink, "+e+":"+c+') : ce "'+g+'" "'+d+'":'+f)},edgeAttributeRemoved:function(d,b,e,c){netstream.LOGGER("(GSSink, "+d+":"+b+') : cn "'+e+'" "'+c+'":null')},graphAttributeAdded:function(e,b,d,c){netstream.LOGGER("(GSSink, "+e+":"+b+') : cg  "'+d+'":'+c)},graphAttributeChanged:function(e,c,d,b,f){netstream.LOGGER("(GSSink, "+e+":"+c+') : cg "'+d+'":'+f)},graphAttributeRemoved:function(d,b,e,c){netstream.LOGGER("(GSSink, "+d+":"+b+') : cg  "'+c+'":null')},graphCleared:function(c,b){netstream.LOGGER("(GSSink, "+c+":"+b+") : cl")},stepBegins:function(c,b,d){netstream.LOGGER("(GSSink, "+c+":"+b+") : st "+d)}};a.netstream.Receiver=function(c){this.sink=null;this.transport=null;this.debug=false;this.stream="Default";for(var d in c){if(c.hasOwnProperty(d)&&this.hasOwnProperty(d)){this[d]=c[d]}}var b=this;this.sink=this.sink||new netstream.DefaultGSSink();this.transport=this.transport||new netstream.Transport(c);this.transport.onevent=function(f){b.receiveEvent(f)};this.transport.connect()};a.netstream.Receiver.prototype={receiveEvent:function(f){var c=0;var b=this.readString(f,c);var e=b.data;c=b.index;if(this.debug){netstream.LOGGER("(netstream.Receiver): Stream "+e+" is addressed in this message")}var d=-1;d=f.getInt8(c++);if(d!=-1){if(d==netstream.constants.EVENT_ADD_NODE){this.serve_EVENT_ADD_NODE(f,c)}else{if((d&255)==(netstream.constants.EVENT_DEL_NODE&255)){this.serve_DEL_NODE(f,c)}else{if(d==netstream.constants.EVENT_ADD_EDGE){this.serve_EVENT_ADD_EDGE(f,c)}else{if(netstream.constants.EVENT_DEL_EDGE==d){this.serve_EVENT_DEL_EDGE(f,c)}else{if(d==netstream.constants.EVENT_STEP){this.serve_EVENT_STEP(f,c)}else{if(d==netstream.constants.EVENT_CLEARED){this.serve_EVENT_CLEARED(f,c)}else{if(d==netstream.constants.EVENT_ADD_GRAPH_ATTR){this.serve_EVENT_ADD_GRAPH_ATTR(f,c)}else{if(d==netstream.constants.EVENT_CHG_GRAPH_ATTR){this.serve_EVENT_CHG_GRAPH_ATTR(f,c)}else{if(d==netstream.constants.EVENT_DEL_GRAPH_ATTR){this.serve_EVENT_DEL_GRAPH_ATTR(f,c)}else{if(d==netstream.constants.EVENT_ADD_NODE_ATTR){this.serve_EVENT_ADD_NODE_ATTR(f,c)}else{if(d==netstream.constants.EVENT_CHG_NODE_ATTR){this.serve_EVENT_CHG_NODE_ATTR(f,c)}else{if(d==netstream.constants.EVENT_DEL_NODE_ATTR){this.serve_EVENT_DEL_NODE_ATTR(f,c)}else{if(d==netstream.constants.EVENT_ADD_EDGE_ATTR){this.serve_EVENT_ADD_EDGE_ATTR(f,c)}else{if(d==netstream.constants.EVENT_CHG_EDGE_ATTR){this.serve_EVENT_CHG_EDGE_ATTR(f,c)}else{if(d==netstream.constants.EVENT_DEL_EDGE_ATTR){this.serve_EVENT_DEL_EDGE_ATTR(f,c)}else{if(d==netstream.constants.EVENT_END){if(this.debug){netstream.LOGGER("(netstream.Receiver.decodeMessage): Client properly ended the connection.")}return}else{if(this.debug){netstream.LOGGER("(netstream.Receiver.decodeMessage): Don't know this command: "+d)}return}}}}}}}}}}}}}}}}}},readType:function(d,b){var c=-1;c=d.getInt8(b);if(c==-1){if(this.debug){netstream.LOGGER("(netstream.Receiver.readType): could not read type")}return 0}return c},readValue:function(c,b,d){if(netstream.constants.TYPE_BOOLEAN==d){return this.readBoolean(c,b)}else{if(netstream.constants.TYPE_BOOLEAN_ARRAY==d){return this.readBooleanArray(c,b)}else{if(netstream.constants.TYPE_BYTE==d){return this.readByte(c,b)}else{if(netstream.constants.TYPE_BYTE_ARRAY==d){return this.readByteArray(c,b)}else{if(netstream.constants.TYPE_SHORT==d){return this.readShort(c,b)}else{if(netstream.constants.TYPE_SHORT_ARRAY==d){return this.readShortArray(c,b)}else{if(netstream.constants.TYPE_INT==d){return this.readInt(c,b)}else{if(netstream.constants.TYPE_INT_ARRAY==d){return this.readIntArray(c,b)}else{if(netstream.constants.TYPE_LONG==d){return this.readLong(c,b)}else{if(netstream.constants.TYPE_LONG_ARRAY==d){return this.readLongArray(c,b)}else{if(netstream.constants.TYPE_FLOAT==d){return this.readFloat(c,b)}else{if(netstream.constants.TYPE_FLOAT_ARRAY==d){return this.readFloatArray(c,b)}else{if(netstream.constants.TYPE_DOUBLE==d){return this.readDouble(c,b)}else{if(netstream.constants.TYPE_DOUBLE_ARRAY==d){return this.readDoubleArray(c,b)}else{if(netstream.constants.TYPE_STRING==d){return this.readString(c,b)}else{if(netstream.constants.TYPE_ARRAY==d){return this.readArray(c,b)}}}}}}}}}}}}}}}}return null},readArray:function(g,e){var b=g.getInt32(e);e+=4;var f=[];var d;for(var c=0;c<b;c++){d=this.readValue(g,e+1,this.readType(g,e));e=rex.index;f[c]=d.data}return{data:f,index:e}},readString:function(e,c){var b=e.getInt32(c);c+=4;var d=netstream.typedArrayToString(new Uint8Array(e.buffer,e.byteOffset+c,b));c+=b;return{data:d,index:c}},readBoolean:function(d,b){var c=d.getInt8(b++);return{data:c===0?false:true,index:b}},readByte:function(d,b){var c=d.getInt8(b++);return{data:c,index:b}},readShort:function(d,b){var c=d.getInt16(b);return{data:c,index:b+2}},readInt:function(d,b){var c=d.getInt32(b);return{data:c,index:b+4}},readLong:function(e,c){var b=e.getInt32(c);if(b!==0){netstream.LOGGER("(netstream.Receiver.readLong) : Read long does not fit in a 32bits int... Big problem !!!!")}var d=e.getInt32(c+4);return{data:d,index:c+8}},readFloat:function(d,b){var c=d.getFloat32(b);return{data:c,index:b+4}},readDouble:function(d,b){var c=d.getFloat64(b);return{data:c,index:b+8}},readIntArray:function(f,d){var b=f.getInt32(d);d+=4;var e=[];for(var c=0;c<b;c++){e[c]=f.getInt32(d);d+=4}return{data:e,index:d}},readBooleanArray:function(f,d){var b=f.getInt32(d);d+=4;var e=[];for(var c=0;c<b;c++){e[c]=f.getInt8(d++);e[c]=e[c]===0?false:true}return{data:e,index:d}},readByteArray:function(f,d){var b=f.getInt32(d);d+=4;var e=[];for(var c=0;c<b;c++){e[c]=f.getInt8(d++)}return{data:e,index:d}},readDoubleArray:function(f,d){var b=f.getInt32(d);d+=4;var e=[];for(var c=0;c<b;c++){e[c]=f.getFloat64(d);d+=8}return{data:e,index:d}},readFloatArray:function(f,d){var b=f.getInt32(d);d+=4;var e=[];for(var c=0;c<b;c++){e[c]=f.getFloat32(d);d+=4}return{data:e,index:d}},readLongArray:function(g,e){var b=g.getInt32(e);e+=4;var d;var f=[];for(var c=0;c<b;c++){d=g.getInt32(e);e+=4;if(d!==0){netstream.LOGGER("(netstream.Receiver.readLong) : Read long does not fit in a 32bits int... Big problem !!!!")}f[c]=g.getInt32(e);e+=4}return{data:f,index:e}},readShortArray:function(f,d){var b=f.getInt32(d);d+=4;var e=[];for(var c=0;c<b;c++){e[c]=f.getInt16(d);d+=2}return{data:e,index:d}},serve_EVENT_DEL_EDGE_ATTR:function(h,c){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received DEL_EDGE_ATTR command.")}var b=this.readString(h,c);var f=b.data;b=this.readLong(h,b.index);var d=b.data;b=this.readString(h,b.index);var g=b.data;b=this.readString(h,b.index);var e=b.data;this.sink.edgeAttributeRemoved(f,d,g,e)},serve_EVENT_CHG_EDGE_ATTR:function(d,j){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received CHG_EDGE_ATTR command.")}var i=this.readString(d,j);var k=i.data;i=this.readLong(d,i.index);var e=i.data;i=this.readString(d,i.index);var h=i.data;i=this.readString(d,i.index);var g=i.data;var f=this.readType(d,i.index);i=this.readValue(d,i.index+1,f);var b=i.data;f=this.readType(d,i.index);i=this.readValue(d,i.index+1,f);var c=i.data;this.sink.edgeAttributeChanged(k,e,h,g,b,c)},serve_EVENT_ADD_EDGE_ATTR:function(i,c){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received ADD_EDGE_ATTR command.")}var b=this.readString(i,c);var g=b.data;b=this.readLong(i,b.index);var d=b.data;b=this.readString(i,b.index);var h=b.data;b=this.readString(i,b.index);var f=b.data;b=this.readValue(i,b.index+1,this.readType(i,b.index));var e=b.data;this.sink.edgeAttributeAdded(g,d,h,f,e)},serve_EVENT_DEL_NODE_ATTR:function(h,c){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received DEL_NODE_ATTR command.")}var b=this.readString(h,c);var f=b.data;b=this.readLong(h,b.index);var d=b.data;b=this.readString(h,b.index);var g=b.data;b=this.readString(h,b.index);var e=b.data;this.sink.nodeAttributeRemoved(f,d,g,e)},serve_EVENT_CHG_NODE_ATTR:function(d,j){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received EVENT_CHG_NODE_ATTR command.")}var i=this.readString(d,j);var k=i.data;i=this.readLong(d,i.index);var f=i.data;i=this.readString(d,i.index);var e=i.data;i=this.readString(d,i.index);var h=i.data;var g=this.readType(d,i.index);i=this.readValue(d,i.index+1,g);if(i===null){return}var b=i.data;g=this.readType(d,i.index);i=this.readValue(d,i.index+1,g);var c=i.data;this.sink.nodeAttributeChanged(k,f,e,h,b,c)},serve_EVENT_ADD_NODE_ATTR:function(i,c){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received EVENT_ADD_NODE_ATTR command.")}var b=this.readString(i,c);var g=b.data;b=this.readLong(i,b.index);var d=b.data;b=this.readString(i,b.index);var h=b.data;b=this.readString(i,b.index);var f=b.data;b=this.readValue(i,b.index+1,this.readType(i,b.index));if(b===null){return}var e=b.data;this.sink.nodeAttributeAdded(g,d,h,f,e)},serve_EVENT_DEL_GRAPH_ATTR:function(g,c){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received EVENT_DEL_GRAPH_ATTR command.")}var b=this.readString(g,c);var f=b.data;b=this.readLong(g,b.index);var d=b.data;b=this.readString(g,b.index);var e=b.data;this.sink.graphAttributeRemoved(f,d,e)},serve_EVENT_CHG_GRAPH_ATTR:function(d,i){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received EVENT_CHG_GRAPH_ATTR command.")}var h=this.readString(d,i);var j=h.data;h=this.readLong(d,h.index);var e=h.data;h=this.readString(d,h.index);var g=h.data;var f=this.readType(d,h.index);h=this.readValue(d,h.index+1,f);var b=h.data;f=this.readType(d,h.index);h=this.readValue(d,h.index+1,f);var c=h.data;this.sink.graphAttributeChanged(j,e,g,b,c)},serve_EVENT_ADD_GRAPH_ATTR:function(h,c){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received EVENT_ADD_GRAPH_ATTR command.")}var b=this.readString(h,c);var g=b.data;b=this.readLong(h,b.index);var d=b.data;b=this.readString(h,b.index);var f=b.data;b=this.readValue(h,b.index+1,this.readType(h,b.index));var e=b.data;this.sink.graphAttributeAdded(g,d,f,e)},serve_EVENT_CLEARED:function(f,c){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received EVENT_CLEARED command.")}var b=this.readString(f,c);var e=b.data;b=this.readLong(f,b.index);var d=b.data;this.sink.graphCleared(e,d)},serve_EVENT_STEP:function(g,c){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received EVENT_STEP command.")}var b=this.readString(g,c);var e=b.data;b=this.readLong(g,b.index);var d=b.data;b=this.readDouble(g,b.index);var f=b.data;this.sink.stepBegins(e,d,f)},serve_EVENT_DEL_EDGE:function(g,c){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received EVENT_DEL_EDGE command.")}var b=this.readString(g,c);var e=b.data;b=this.readLong(g,b.index);var d=b.data;b=this.readString(g,b.index);var f=b.data;this.sink.edgeRemoved(e,d,f)},serve_EVENT_ADD_EDGE:function(c,g){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received ADD_EDGE command.")}var f=this.readString(c,g);var j=f.data;f=this.readLong(c,f.index);var d=f.data;f=this.readString(c,f.index);var e=f.data;f=this.readString(c,f.index);var h=f.data;f=this.readString(c,f.index);var i=f.data;f=this.readBoolean(c,f.index);var b=f.data;this.sink.edgeAdded(j,d,e,h,i,b)},serve_DEL_NODE:function(g,c){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received DEL_NODE command.")}var b=this.readString(g,c);var e=b.data;b=this.readLong(g,b.index);var d=b.data;b=this.readString(g,b.index);var f=b.data;this.sink.nodeRemoved(e,d,f)},serve_EVENT_ADD_NODE:function(g,c){if(this.debug){netstream.LOGGER("(netstream.Receiver.readLong) : Received EVENT_ADD_NODE command")}var b=this.readString(g,c);var e=b.data;b=this.readLong(g,b.index);var d=b.data;b=this.readString(g,b.index);var f=b.data;this.sink.nodeAdded(e,d,f)}}}(this));(function(a){if(!a.netstream){a.netstream={}}a.netstream.Source=function(b){this.debug=true;this.sender=null;this.stream=null;this.id=null;for(var c in b){if(b.hasOwnProperty(c)&&this.hasOwnProperty(c)){this[c]=b[c]}}if(this.stream){this.sender.stream=this.stream}this.id=this.id||"s"+Math.floor(Math.random()*1000);this._timeId=0};a.netstream.Source.prototype={addNode:function(b){this.sender.nodeAdded(this.id,this._timeId,b);this._timeId+=1},removeNode:function(b){this.sender.nodeRemoved(this.id,this._timeId,b);this._timeId+=1},addEdge:function(e,b,c,d){this.sender.edgeAdded(this.id,this._timeId,e,b,c,d);this._timeId+=1},removeEdge:function(b){this.sender.edgeRemoved(this.id,this._timeId,b);this._timeId+=1},addAttribute:function(b,c){this.sender.graphAttributeAdded(this.id,this._timeId,b,c);this._timeId+=1},removeAttribute:function(b){this.sender.graphAttributeRemoved(this.id,this._timeId,b);this._timeId+=1},changeAttribute:function(c,b,d){this.sender.graphAttributeChanged(this.id,this._timeId,c,b,d);this._timeId+=1},addNodeAttribute:function(c,b,d){this.sender.nodeAttributeAdded(this.id,this._timeId,c,b,d);this._timeId+=1},removeNodeAttibute:function(c,b){this.sender.nodeAttributeRemoved(this.id,this._timeId,c,b);this._timeId+=1},changeNodeAttribute:function(d,c,b,e){this.sender.nodeAttributeChanged(this.id,this._timeId,d,c,b,e);this._timeId+=1},addEdgeAttribute:function(c,b,d){this.sender.edgeAttributeAdded(this.id,this._timeId,c,b,d);this._timeId+=1},removeEdgeAttribute:function(c,b){this.sender.edgeAttributeRemoved(this.id,this._timeId,c,b);this._timeId+=1},changeEdgeAttrivute:function(d,c,b,e){this.sender.edgeAttributeChanged(this.id,this._timeId,d,c,b,e);this._timeId+=1},clearGraph:function(){this.sender.graphCleared(this.id,this._timeId);this._timeId+=1},stepBegins:function(b){this.sender.stepBegins(this.id,this._timeId,b);this._timeId+=1}};a.netstream.Sender=function(b){this.BUFFER_INITIAL_SIZE=4096;this.debug=true;this.transport=null;this.stream="default";this.onopen=null;for(var c in b){if(b.hasOwnProperty(c)&&this.hasOwnProperty(c)){this[c]=b[c]}}this.buffer=new ArrayBuffer(this.BUFFER_INITIAL_SIZE);this.pos=0;this.view=new DataView(this.buffer,0)};a.netstream.Sender.prototype={graphAttributeAdded:function(f,e,c,d){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_ADD_GRAPH_ATTR);this._encodeString(f);this._encodeLong(e);this._encodeString(c);var b=this._getType(d);this._encodeByte(b);this._encodeValue(d,b);this._send()},graphAttributeChanged:function(g,f,e,b,c){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_CHG_GRAPH_ATTR);this._encodeString(g);this._encodeLong(f);this._encodeString(e);var d=this._getType(b);this._encodeByte(d);this._encodeValue(b,d);d=this._getType(c);this._encodeByte(d);this._encodeValue(c,d);this._send()},graphAttributeRemoved:function(d,c,b){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_DEL_GRAPH_ATTR);this._encodeString(d);this._encodeLong(c);this._encodeString(b);this._send()},nodeAttributeAdded:function(g,f,e,c,d){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_ADD_NODE_ATTR);this._encodeString(g);this._encodeLong(f);this._encodeString(e);this._encodeString(c);var b=this._getType(d);this._encodeByte(b);this._encodeValue(d,b);this._send()},nodeAttributeChanged:function(h,g,f,e,b,c){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_CHG_NODE_ATTR);this._encodeString(h);this._encodeLong(g);this._encodeString(f);this._encodeString(e);var d=this._getType(b);this._encodeByte(d);this._encodeValue(b,d);d=this._getType(c);this._encodeByte(d);this._encodeValue(c,d);this._send()},nodeAttributeRemoved:function(e,d,c,b){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_DEL_NODE_ATTR);this._encodeString(e);this._encodeLong(d);this._encodeString(c);this._encodeString(b);this._send()},edgeAttributeAdded:function(g,f,b,d,e){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_ADD_EDGE_ATTR);this._encodeString(g);this._encodeLong(f);this._encodeString(b);this._encodeString(d);var c=this._getType(e);this._encodeByte(c);this._encodeValue(e,c);this._send()},edgeAttributeChanged:function(h,g,b,f,c,d){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_CHG_EDGE_ATTR);this._encodeString(h);this._encodeLong(g);this._encodeString(b);this._encodeString(f);var e=this._getType(c);this._encodeByte(e);this._encodeValue(c,e);e=this._getType(d);this._encodeByte(e);this._encodeValue(d,e);this._send()},edgeAttributeRemoved:function(e,d,b,c){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_DEL_EDGE_ATTR);this._encodeString(e);this._encodeLong(d);this._encodeString(b);this._encodeString(c);this._send()},nodeAdded:function(d,c,b){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_ADD_NODE);this._encodeString(d);this._encodeLong(c);this._encodeString(b);this._send()},nodeRemoved:function(d,c,b){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_DEL_NODE);this._encodeString(d);this._encodeLong(c);this._encodeString(b);this._send()},edgeAdded:function(g,f,c,b,d,e){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_ADD_EDGE);this._encodeString(g);this._encodeLong(f);this._encodeString(c);this._encodeString(b);this._encodeString(d);this._encodeBoolean(e);this._send()},edgeRemoved:function(d,c,b){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_DEL_EDGE);this._encodeString(d);this._encodeLong(c);this._encodeString(b);this._send()},stepBegins:function(d,c,b){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_STEP);this._encodeString(d);this._encodeLong(c);this._encodeDouble(b)},graphCleared:function(c,b){this._encodeString(this.stream);this._encodeByte(netstream.constants.EVENT_CLEARED);this._encodeString(c);this._encodeLong(b)},_ensureBufferCapacityFor:function(c){if(c+this.pos>this.buffer.byteLength){if(this.debug){netstream.LOGGER("Actual buffer size is "+this.buffer.byteLength+" resizing to "+((this.byteLength*1.4>(c+this.pos))?this.byteLength*1.4:c+this.pos)+" bytes",c,this.pos)}var d=new ArrayBuffer(((this.byteLength*1.4>(c+this.pos))?this.byteLength*1.4:c+this.pos)),b=0;for(;b<this.pos;b++){d[b]=this.buffer[b]}delete this.buffer;this.buffer=d;this.view=new DataView(this.buffer,0)}},_getType:function(d){var c=typeof d.forEach!=="undefined";var b=0;if(c===true){d=d[0]}if(typeof d==="boolean"){if(c){b=netstream.constants.TYPE_BOOLEAN_ARRAY}else{b=netstream.constants.TYPE_BOOLEAN}}else{if(typeof d==="number"){if(c){b=netstream.constants.TYPE_DOUBLE_ARRAY}else{b=netstream.constants.TYPE_DOUBLE}}else{if(typeof d==="string"){b=netstream.constants.TYPE_STRING}else{if(typeof d==="object"){throw"You tried to send an object through the NetStream Protocol, though it is not yet implemented."}}}}return b},_encodeValue:function(c,b){if(netstream.constants.TYPE_BOOLEAN===b){return this._encodeBoolean(c)}else{if(netstream.constants.TYPE_BOOLEAN_ARRAY===b){return;this._encodeBooleanArray(c)}else{if(netstream.constants.TYPE_DOUBLE===b){return this._encodeDouble(c)}else{if(netstream.constants.TYPE_DOUBLE_ARRAY===b){return;this._encodeDoubleArray(c)}else{if(netstream.constants.TYPE_STRING===b){return this._encodeString(c)}}}}}return null},_encodeString:function(e){var c=netstream.utf16to8(e);this._ensureBufferCapacityFor(4+c.length);this.view.setInt32(this.pos,c.length);this.pos+=4;for(var d=0,b=c.length;d<b;d++){this.view.setUint8(this.pos++,c.charCodeAt(d))}},_encodeLong:function(b){this._ensureBufferCapacityFor(8);this.view.setInt32(this.pos,0);this.pos+=4;this.view.setInt32(this.pos,b);this.pos+=4},_encodeDouble:function(b){this._ensureBufferCapacityFor(8);this.view.setFloat64(this.pos,b);this.pos+=8},_encodeDoubleArray:function(b){this._ensureBufferCapacityFor(4+8*b.length);this.view.setInt32(this.pos,b.length);this.pos+=4;b.forEach(function(c){if(typeof c!=="number"){throw"All the elements of an Array should be of the same type"}this.view.setFloat64(this.pos,c);this.pos+=8})},_encodeBoolean:function(b){this._ensureBufferCapacityFor(1);this.view.setUint8(this.pos++,b?1:0)},_encodeBooleanArray:function(b){this._ensureBufferCapacityFor(4+b.length);this.view.setInt32(this.pos,b.length);this.pos+=4;b.forEach(function(c){if(typeof c!=="boolean"){throw"All the elements of an Array should be of the same type"}this.view.setUint8(this.pos++,c?1:0)})},_encodeByte:function(b){this._ensureBufferCapacityFor(1);this.view.setUint8(this.pos++,b)},_encodeByteArray:function(b){this._ensureBufferCapacityFor(4+b.length);this.view.setInt32(this.pos,b.length);this.pos+=4;b.forEach(function(c){if(typeof c!=="number"){throw"All the elements of an Array should be of the same type"}this.view.setUint8(this.pos++,c)})},_send:function(){if(this.transport===null){throw"no transport available. Specify one before sending anything. Packet drop."}this.transport.sendEvent(this.buffer,0,this.pos);this.pos=0}}}(this));